"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _axios=_interopRequireDefault(require("axios"));var _reactQuery=require("react-query");var _this=void 0,_jsxFileName="/Users/ghulamrasool/Desktop/code/PaginatedList/src/PaginatedList.js";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{"default":e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n["default"]=e,t&&t.set(e,n),n;}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){(0,_defineProperty2["default"])(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}var PaginatedList=function PaginatedList(_ref){var CardComponent=_ref.CardComponent,endpoint=_ref.endpoint,_ref$itemsPerPage=_ref.itemsPerPage,itemsPerPage=_ref$itemsPerPage===void 0?30:_ref$itemsPerPage,_ref$collectionPath=_ref.collectionPath,collectionPath=_ref$collectionPath===void 0?'data':_ref$collectionPath,_ref$refetchKey=_ref.refetchKey,refetchKey=_ref$refetchKey===void 0?0:_ref$refetchKey,_ref$columns=_ref.columns,columns=_ref$columns===void 0?1:_ref$columns,_ref$emptyMessageEnti=_ref.emptyMessageEntity,emptyMessageEntity=_ref$emptyMessageEnti===void 0?'items':_ref$emptyMessageEnti,_ref$axiosInstance=_ref.axiosInstance,axiosInstance=_ref$axiosInstance===void 0?_axios["default"]:_ref$axiosInstance,_ref$loaderColor=_ref.loaderColor,loaderColor=_ref$loaderColor===void 0?'lightgrey':_ref$loaderColor;var fetchItems=(0,_react.useCallback)(function(){var _ref3=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(_ref2){var _ref2$pageParam,pageParam,response;return _regenerator["default"].wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_ref2$pageParam=_ref2.pageParam,pageParam=_ref2$pageParam===void 0?1:_ref2$pageParam;_context.next=3;return axiosInstance.get(endpoint,{params:{'pagination[page]':pageParam,'pagination[pageSize]':itemsPerPage}});case 3:response=_context.sent;if(!(!response||!response.data)){_context.next=6;break;}throw new Error("Invalid response from server");case 6:return _context.abrupt("return",{data:response.data[collectionPath],nextPage:response.data.meta.pagination.page+1,totalPages:response.data.meta.pagination.pageCount});case 7:case"end":return _context.stop();}},_callee);}));return function(_x){return _ref3.apply(this,arguments);};}(),[endpoint,itemsPerPage,collectionPath,axiosInstance]);var _useInfiniteQuery=(0,_reactQuery.useInfiniteQuery)(['items',endpoint,refetchKey],fetchItems,{getNextPageParam:function getNextPageParam(lastPage){return lastPage.nextPage<=lastPage.totalPages?lastPage.nextPage:undefined;},enabled:!!endpoint,select:(0,_react.useCallback)(function(data){return _objectSpread(_objectSpread({},data),{},{pages:data.pages.flatMap(function(page){return page.data;})});},[])}),data=_useInfiniteQuery.data,fetchNextPage=_useInfiniteQuery.fetchNextPage,hasNextPage=_useInfiniteQuery.hasNextPage,isFetchingNextPage=_useInfiniteQuery.isFetchingNextPage,isLoading=_useInfiniteQuery.isLoading,isError=_useInfiniteQuery.isError,error=_useInfiniteQuery.error;var itemList=(data===null||data===void 0?void 0:data.pages)||[];var renderItem=(0,_react.useCallback)(function(_ref4){var item=_ref4.item;return _react["default"].createElement(CardComponent,{item:item,__self:_this,__source:{fileName:_jsxFileName,lineNumber:57,columnNumber:9}});},[CardComponent]);var renderFooter=(0,_react.useCallback)(function(){if(!isFetchingNextPage)return null;return _react["default"].createElement(_reactNative.ActivityIndicator,{style:styles.loader,size:"large",color:loaderColor,__self:_this,__source:{fileName:_jsxFileName,lineNumber:62,columnNumber:16}});},[isFetchingNextPage,loaderColor]);var keyExtractor=(0,_react.useCallback)(function(item){var _item$id$toString,_item$id;return(_item$id$toString=(_item$id=item.id)===null||_item$id===void 0?void 0:_item$id.toString())!==null&&_item$id$toString!==void 0?_item$id$toString:Math.random().toString();},[]);var onEndReached=(0,_react.useCallback)(function(){if(hasNextPage){fetchNextPage();}},[hasNextPage,fetchNextPage]);if(isLoading&&!isError){return _react["default"].createElement(_reactNative.ActivityIndicator,{style:styles.loader,size:"large",color:loaderColor,__self:_this,__source:{fileName:_jsxFileName,lineNumber:77,columnNumber:16}});}if(isError){return _react["default"].createElement(_reactNative.View,{style:styles.errorContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:82,columnNumber:13}},_react["default"].createElement(_reactNative.Text,{style:styles.errorMessage,__self:_this,__source:{fileName:_jsxFileName,lineNumber:83,columnNumber:17}},"Error: ",(error===null||error===void 0?void 0:error.message)||'An unknown error occurred'));}if(itemList.length===0){return _react["default"].createElement(_reactNative.View,{style:styles.emptyContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:91,columnNumber:13}},_react["default"].createElement(_reactNative.Text,{style:styles.emptyMessage,__self:_this,__source:{fileName:_jsxFileName,lineNumber:92,columnNumber:17}},"No ",emptyMessageEntity," found."));}return _react["default"].createElement(_reactNative.FlatList,{data:itemList,renderItem:renderItem,keyExtractor:keyExtractor,onEndReached:onEndReached,numColumns:columns,onEndReachedThreshold:0.7,ListFooterComponent:renderFooter,__self:_this,__source:{fileName:_jsxFileName,lineNumber:100,columnNumber:9}});};var styles=_reactNative.StyleSheet.create({loader:{paddingVertical:20},emptyContainer:{flex:1,justifyContent:'center',alignItems:'center',padding:20},emptyMessage:{fontSize:18,color:'gray'},errorContainer:{flex:1,justifyContent:'center',alignItems:'center',padding:20},errorMessage:{fontSize:18,color:'red'}});var _default=exports["default"]=PaginatedList;